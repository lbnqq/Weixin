<!--pages/test-supabase/test-supabase.wxml-->
<view class="container">
  <view class="header">
    <text class="title">Supabase 连接测试</text>
    <text class="subtitle">测试用户信息保存功能</text>
  </view>

  <view class="test-result" wx:if="{{testResult}}">
    <text class="result-text">{{testResult}}</text>
  </view>

  <view class="user-info" wx:if="{{userInfo}}">
    <view class="user-card">
      <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
      <view class="user-details">
        <text class="nickname">{{userInfo.nickName}}</text>
        <text class="openid">OpenID: {{userInfo.openid}}</text>
      </view>
    </view>
  </view>

  <view class="button-group">
    <button 
      class="test-btn" 
      type="primary" 
      bindtap="testConnection"
      loading="{{isLoading}}"
      disabled="{{isLoading}}">
      测试连接
    </button>
    
    <button 
      class="test-btn" 
      type="primary" 
      bindtap="testUserLogin"
      loading="{{isLoading}}"
      disabled="{{isLoading}}">
      测试用户登录
    </button>
    
    <!-- 用户信息授权按钮 -->
    <button 
      class="test-btn auth-btn" 
      type="primary" 
      bindtap="handleUserInfoAuth"
      loading="{{isLoading}}"
      disabled="{{isLoading}}"
      wx:if="{{showUserInfoButton}}">
      授权用户信息
    </button>
    
    <button 
      class="test-btn" 
      type="default" 
      bindtap="testQueryUser"
      loading="{{isLoading}}"
      disabled="{{isLoading || !userInfo}}">
      查询用户信息
    </button>
    
    <button 
      class="test-btn" 
      type="default" 
      bindtap="testUpdateUser"
      loading="{{isLoading}}"
      disabled="{{isLoading || !userInfo}}">
      更新用户信息
    </button>
    
    <button 
      class="test-btn" 
      type="default" 
      bindtap="viewAllUsers"
      loading="{{isLoading}}"
      disabled="{{isLoading}}">
      查看所有用户
    </button>
    
    <button 
      class="test-btn clear-btn" 
      type="warn" 
      bindtap="clearTestData"
      loading="{{isLoading}}"
      disabled="{{isLoading || !userInfo}}">
      清除测试数据
    </button>
  </view>

  <view class="loading" wx:if="{{isLoading}}">
    <text>测试中，请稍候...</text>
  </view>
</view>