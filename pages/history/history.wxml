<!--pages/history/history.wxml-->
<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header-section">
    <text class="page-title">æµ‹è¯•å†å²</text>
    <text class="page-subtitle">æœ€å¤šä¿å­˜5æ¡æµ‹è¯•è®°å½•</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading-section">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{!isLoading && isEmpty}}" class="empty-section">
    <view class="empty-icon">ğŸ“‹</view>
    <text class="empty-title">æš‚æ— æµ‹è¯•è®°å½•</text>
    <text class="empty-subtitle">å®Œæˆæµ‹è¯•åï¼Œç»“æœä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
    <button class="start-test-btn" bindtap="startNewTest">å¼€å§‹æµ‹è¯•</button>
  </view>

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <view wx:if="{{!isLoading && !isEmpty}}" class="history-section">
    <!-- æ¸…ç©ºæŒ‰é’® -->
    <view class="section-actions">
      <button class="clear-btn" bindtap="clearAllHistory">æ¸…ç©ºå†å²</button>
    </view>

    <!-- è®°å½•åˆ—è¡¨ -->
    <view class="history-list">
      <view wx:for="{{testHistory}}" wx:key="timestamp"
            class="history-item">
        <view class="item-content" bindtap="viewResult" data-index="{{index}}">
          <view class="item-header">
            <text class="item-date">{{item.testDate}}</text>
            <text class="item-type">{{item.personalityType}}</text>
          </view>

          <view class="item-scores">
            <view class="score-bar-item">
              <text class="score-label">å¼€æ”¾æ€§</text>
              <view class="mini-score-bar">
                <view class="mini-score-fill" style="width: {{item.scores.openness.average / 5 * 100}}%"></view>
              </view>
              <text class="score-value">{{item.scores.openness.average}}</text>
            </view>

            <view class="score-bar-item">
              <text class="score-label">å°½è´£æ€§</text>
              <view class="mini-score-bar">
                <view class="mini-score-fill" style="width: {{item.scores.conscientiousness.average / 5 * 100}}%"></view>
              </view>
              <text class="score-value">{{item.scores.conscientiousness.average}}</text>
            </view>

            <view class="score-bar-item">
              <text class="score-label">å¤–å‘æ€§</text>
              <view class="mini-score-bar">
                <view class="mini-score-fill" style="width: {{item.scores.extraversion.average / 5 * 100}}%"></view>
              </view>
              <text class="score-value">{{item.scores.extraversion.average}}</text>
            </view>

            <view class="score-bar-item">
              <text class="score-label">å®œäººæ€§</text>
              <view class="mini-score-bar">
                <view class="mini-score-fill" style="width: {{item.scores.agreeableness.average / 5 * 100}}%"></view>
              </view>
              <text class="score-value">{{item.scores.agreeableness.average}}</text>
            </view>

            <view class="score-bar-item">
              <text class="score-label">ç¥ç»è´¨</text>
              <view class="mini-score-bar">
                <view class="mini-score-fill" style="width: {{item.scores.neuroticism.average / 5 * 100}}%"></view>
              </view>
              <text class="score-value">{{item.scores.neuroticism.average}}</text>
            </view>
          </view>

          <view class="item-summary">
            <text class="summary-text">æ€»åˆ†ï¼š{{item.totalAverage}} | æœ€é«˜ï¼š{{item.highest.name}} ({{item.highest.score}})</text>
          </view>
        </view>

        <view class="item-actions">
          <button class="delete-btn" bindtap="deleteRecord" data-index="{{index}}">
            <text class="delete-icon">ğŸ—‘ï¸</text>
          </button>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œ -->
    <view class="bottom-actions">
      <button class="action-btn" bindtap="startNewTest">
        <text class="btn-icon">ğŸ§ </text>
        <text class="btn-text">é‡æ–°æµ‹è¯•</text>
      </button>
    </view>
  </view>
</view>