<!--pages/history/history.wxml-->
<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header-section">
    <text class="page-title">æµ‹è¯•å†å²</text>
    <text class="page-subtitle">å…±{{totalCount}}æ¡è®°å½•</text>
    <button class="refresh-btn" bindtap="refreshHistory" disabled="{{isLoading}}">
      <text class="refresh-icon">{{isLoading ? 'âŸ³' : 'ğŸ”„'}}</text>
    </button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading && testHistory.length === 0}}" class="loading-section">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{!isLoading && isEmpty}}" class="empty-section">
    <view class="empty-icon">ğŸ“‹</view>
    <text class="empty-title">æš‚æ— æµ‹è¯•è®°å½•</text>
    <text class="empty-subtitle">å®Œæˆæµ‹è¯•åï¼Œç»“æœä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
    <button class="start-test-btn" bindtap="startNewTest">å¼€å§‹æµ‹è¯•</button>
  </view>

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <view wx:if="{{!isEmpty}}" class="history-section">
    <!-- è®°å½•åˆ—è¡¨ -->
    <view class="history-list">
      <view wx:for="{{testHistory}}" wx:key="testId"
            class="history-item">
        <view class="item-content" bindtap="viewResult" data-index="{{index}}">
          <view class="item-header">
            <text class="item-date">{{item.formattedDate}}</text>
            <view class="item-meta">
              <text class="item-duration">{{item.duration}}ç§’</text>
              <text class="item-score">{{item.totalScore}}åˆ†</text>
            </view>
          </view>

          <view class="item-summary">
            <text class="summary-text">{{item.summary}}</text>
          </view>

          <view class="item-scores">
            <view class="score-row">
              <view class="score-item">
                <text class="score-label">å¼€æ”¾æ€§</text>
                <view class="mini-score-bar">
                  <view class="mini-score-fill" style="width: {{item.formattedScores.openness}}%"></view>
                </view>
                <text class="score-value">{{item.formattedScores.openness}}</text>
              </view>
              <view class="score-item">
                <text class="score-label">å°½è´£æ€§</text>
                <view class="mini-score-bar">
                  <view class="mini-score-fill" style="width: {{item.formattedScores.conscientiousness}}%"></view>
                </view>
                <text class="score-value">{{item.formattedScores.conscientiousness}}</text>
              </view>
            </view>
            <view class="score-row">
              <view class="score-item">
                <text class="score-label">å¤–å‘æ€§</text>
                <view class="mini-score-bar">
                  <view class="mini-score-fill" style="width: {{item.formattedScores.extraversion}}%"></view>
                </view>
                <text class="score-value">{{item.formattedScores.extraversion}}</text>
              </view>
              <view class="score-item">
                <text class="score-label">å®œäººæ€§</text>
                <view class="mini-score-bar">
                  <view class="mini-score-fill" style="width: {{item.formattedScores.agreeableness}}%"></view>
                </view>
                <text class="score-value">{{item.formattedScores.agreeableness}}</text>
              </view>
            </view>
            <view class="score-row">
              <view class="score-item">
                <text class="score-label">ç¥ç»è´¨</text>
                <view class="mini-score-bar">
                  <view class="mini-score-fill" style="width: {{item.formattedScores.neuroticism}}%"></view>
                </view>
                <text class="score-value">{{item.formattedScores.neuroticism}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{hasMore && !isLoading}}" class="load-more-section">
      <button class="load-more-btn" bindtap="loadMore">åŠ è½½æ›´å¤š</button>
    </view>

    <!-- åŠ è½½ä¸­çŠ¶æ€ -->
    <view wx:if="{{isLoading && testHistory.length > 0}}" class="loading-more-section">
      <text class="loading-more-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- åº•éƒ¨æ“ä½œ -->
    <view class="bottom-actions">
      <button class="action-btn" bindtap="startNewTest">
        <text class="btn-icon">ğŸ§ </text>
        <text class="btn-text">é‡æ–°æµ‹è¯•</text>
      </button>
      <button class="action-btn secondary" bindtap="shareHistory" wx:if="{{testHistory.length > 0}}">
        <text class="btn-icon">ğŸ“¤</text>
        <text class="btn-text">åˆ†äº«è®°å½•</text>
      </button>
    </view>
  </view>
</view>