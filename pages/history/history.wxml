<!--pages/history/history.wxml-->
<view class="container">
  <!-- 头部 -->
  <view class="header-section">
    <text class="page-title">测试历史</text>
    <text class="page-subtitle">最多保存5条测试记录</text>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{isLoading}}" class="loading-section">
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 空状态 -->
  <view wx:if="{{!isLoading && isEmpty}}" class="empty-section">
    <view class="empty-icon">📋</view>
    <text class="empty-title">暂无测试记录</text>
    <text class="empty-subtitle">完成测试后，结果会显示在这里</text>
    <button class="start-test-btn" bindtap="startNewTest">开始测试</button>
  </view>

  <!-- 历史记录列表 -->
  <view wx:if="{{!isLoading && !isEmpty}}" class="history-section">
    <!-- 清空按钮 -->
    <view class="section-actions">
      <button class="clear-btn" bindtap="clearAllHistory">清空历史</button>
    </view>

    <!-- 记录列表 -->
    <view class="history-list">
      <view wx:for="{{testHistory}}" wx:key="timestamp"
            class="history-item">
        <view class="item-content" bindtap="viewResult" data-index="{{index}}">
          <view class="item-header">
            <text class="item-date">{{item.testDate}}</text>
            <text class="item-type">{{item.personalityType}}</text>
          </view>

          <view class="item-scores">
            <view class="score-bar-item">
              <text class="score-label">开放性</text>
              <view class="mini-score-bar">
                <view class="mini-score-fill" style="width: {{item.scores.openness.average / 5 * 100}}%"></view>
              </view>
              <text class="score-value">{{item.scores.openness.average}}</text>
            </view>

            <view class="score-bar-item">
              <text class="score-label">尽责性</text>
              <view class="mini-score-bar">
                <view class="mini-score-fill" style="width: {{item.scores.conscientiousness.average / 5 * 100}}%"></view>
              </view>
              <text class="score-value">{{item.scores.conscientiousness.average}}</text>
            </view>

            <view class="score-bar-item">
              <text class="score-label">外向性</text>
              <view class="mini-score-bar">
                <view class="mini-score-fill" style="width: {{item.scores.extraversion.average / 5 * 100}}%"></view>
              </view>
              <text class="score-value">{{item.scores.extraversion.average}}</text>
            </view>

            <view class="score-bar-item">
              <text class="score-label">宜人性</text>
              <view class="mini-score-bar">
                <view class="mini-score-fill" style="width: {{item.scores.agreeableness.average / 5 * 100}}%"></view>
              </view>
              <text class="score-value">{{item.scores.agreeableness.average}}</text>
            </view>

            <view class="score-bar-item">
              <text class="score-label">神经质</text>
              <view class="mini-score-bar">
                <view class="mini-score-fill" style="width: {{item.scores.neuroticism.average / 5 * 100}}%"></view>
              </view>
              <text class="score-value">{{item.scores.neuroticism.average}}</text>
            </view>
          </view>

          <view class="item-summary">
            <text class="summary-text">总分：{{item.totalAverage}} | 最高：{{item.highest.name}} ({{item.highest.score}})</text>
          </view>
        </view>

        <view class="item-actions">
          <button class="delete-btn" bindtap="deleteRecord" data-index="{{index}}">
            <text class="delete-icon">🗑️</text>
          </button>
        </view>
      </view>
    </view>

    <!-- 底部操作 -->
    <view class="bottom-actions">
      <button class="action-btn" bindtap="startNewTest">
        <text class="btn-icon">🧠</text>
        <text class="btn-text">重新测试</text>
      </button>
    </view>
  </view>
</view>