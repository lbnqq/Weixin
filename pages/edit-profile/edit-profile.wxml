<!--pages/edit-profile/edit-profile.wxml-->
<view class="container">
  <!-- 头像编辑区域 -->
  <view class="avatar-section">
    <view class="section-title">头像</view>
    <view class="avatar-container" bindtap="chooseAvatar">
      <image class="avatar-image" src="{{tempAvatarUrl || userInfo.avatarUrl}}" mode="aspectFill" />
      <view class="avatar-overlay">
        <text class="avatar-icon">📷</text>
        <text class="avatar-text">点击更换</text>
      </view>
    </view>
    <text class="avatar-tip">支持JPG、PNG格式，大小不超过2MB</text>
  </view>

  <!-- 昵称编辑区域 -->
  <view class="nickname-section">
    <view class="section-title">昵称</view>
    <view class="nickname-container">
      <input
        class="nickname-input"
        type="text"
        placeholder="请输入昵称"
        value="{{tempNickname}}"
        bindinput="onNicknameInput"
        maxlength="20"
      />
      <view class="nickname-count">{{tempNickname.length}}/20</view>
    </view>
    <text class="nickname-tip">昵称长度2-20个字符，支持中英文、数字</text>
  </view>

  <!-- 原始信息展示（用于对比） -->
  <view class="original-info-section">
    <view class="section-title">当前信息</view>
    <view class="info-item">
      <text class="info-label">原始头像：</text>
      <image class="info-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill" />
    </view>
    <view class="info-item">
      <text class="info-label">原始昵称：</text>
      <text class="info-value">{{userInfo.nickName}}</text>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-section">
    <button
      class="save-btn {{!hasChanges ? 'disabled' : ''}}"
      bindtap="saveProfile"
      disabled="{{!hasChanges || isSaving}}"
    >
      {{isSaving ? '保存中...' : '保存修改'}}
    </button>

    <button class="reset-btn" bindtap="resetChanges">重置</button>

    <button class="cancel-btn" bindtap="goBack">取消</button>
  </view>

  <!-- 保存成功提示 -->
  <view wx:if="{{showSaveSuccess}}" class="success-toast">
    <text class="success-icon">✅</text>
    <text class="success-text">保存成功</text>
  </view>
</view>

<!-- 图片裁剪弹窗 -->
<view wx:if="{{showCropper}}" class="cropper-modal">
  <view class="cropper-container">
    <view class="cropper-header">
      <text class="cropper-title">裁剪头像</text>
      <button class="cropper-close" bindtap="closeCropper">×</button>
    </view>
    <view class="cropper-content">
      <image
        class="cropper-image"
        src="{{cropImageUrl}}"
        mode="aspectFit"
      ></image>
    </view>
    <view class="cropper-actions">
      <button class="crop-cancel-btn" bindtap="closeCropper">取消</button>
      <button class="crop-confirm-btn" bindtap="confirmCrop">确认裁剪</button>
    </view>
  </view>
</view>