<!--pages/profile/profile.wxml-->
<view class="container">
  <!-- 用户信息头部 -->
  <view class="header-section">
    <view wx:if="{{isLoggedIn}}">
      <view class="user-card" bindtap="editProfile">
        <image class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill" />
        <view class="user-info">
          <text class="user-name">{{userInfo.nickName}}</text>
          <text class="user-status">已登录</text>
        </view>
        <view class="edit-btn">
          <text class="edit-icon">✏️</text>
          <text class="edit-text">编辑</text>
        </view>
      </view>
      <view class="logout-section">
        <button class="logout-btn" bindtap="handleLogout">退出登录</button>
      </view>
    </view>

    <view wx:else class="login-card">
      <view class="login-header">
        <view class="login-avatar">
          <text class="avatar-icon">👤</text>
        </view>
        <view class="login-title">
          <text class="title-main">欢迎使用大五人格测试</text>
          <text class="title-sub">登录后体验完整功能，保存测试记录</text>
        </view>
      </view>
      
      <view class="login-features">
        <view class="feature-item">
          <view class="feature-icon">📊</view>
          <text class="feature-text">保存测试记录</text>
        </view>
        <view class="feature-item">
          <view class="feature-icon">🤖</view>
          <text class="feature-text">AI个性分析</text>
        </view>
        <view class="feature-item">
          <view class="feature-icon">📈</view>
          <text class="feature-text">成长轨迹追踪</text>
        </view>
      </view>
      
      <button class="wechat-login-btn" bindtap="showLoginModal">
        <view class="btn-icon">
          <text class="wechat-icon-text">💬</text>
        </view>
        <text class="btn-text">微信快速登录</text>
      </button>
      
      <view class="login-agreement">
        <text class="agreement-prefix">登录即表示同意</text>
        <text class="agreement-link" bindtap="viewAgreement">《用户协议》</text>
        <text class="agreement-separator">和</text>
        <text class="agreement-link" bindtap="viewPrivacy">《隐私政策》</text>
      </view>
    </view>
  </view>

  <!-- 统计数据 -->
  <view wx:if="{{isLoggedIn}}" class="stats-section">
    <view class="section-title">我的测试统计</view>
    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-number">{{stats.totalTests}}</text>
        <text class="stat-label">总测试次数</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.averageScore}}</text>
        <text class="stat-label">平均得分</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.latestDate || '--'}}</text>
        <text class="stat-label">最近测试</text>
      </view>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <view class="section-title">功能菜单</view>

    <view class="menu-list">
      <view wx:if="{{isLoggedIn}}" class="menu-item" bindtap="editProfile">
        <view class="menu-icon">👤</view>
        <text class="menu-text">编辑资料</text>
        <text class="menu-arrow">></text>
      </view>

      <view class="menu-item" bindtap="startTest">
        <view class="menu-icon">🧠</view>
        <text class="menu-text">开始测试</text>
        <text class="menu-arrow">></text>
      </view>

      <view class="menu-item" bindtap="viewHistory">
        <view class="menu-icon">📋</view>
        <text class="menu-text">测试历史</text>
        <text class="menu-arrow">></text>
      </view>

      <view class="menu-item" bindtap="shareApp">
        <view class="menu-icon">📤</view>
        <text class="menu-text">分享应用</text>
        <text class="menu-arrow">></text>
      </view>
    </view>
  </view>

  <!-- 设置菜单 -->
  <view class="settings-section">
    <view class="section-title">设置</view>

    <view class="menu-list">
      <view class="menu-item" bindtap="aboutUs">
        <view class="menu-icon">ℹ️</view>
        <text class="menu-text">关于我们</text>
        <text class="menu-arrow">></text>
      </view>

      <view class="menu-item" bindtap="feedback">
        <view class="menu-icon">💬</view>
        <text class="menu-text">意见反馈</text>
        <text class="menu-arrow">></text>
      </view>

      <view class="menu-item danger" bindtap="clearData">
        <view class="menu-icon">🗑️</view>
        <text class="menu-text">清除数据</text>
        <text class="menu-arrow">></text>
      </view>
    </view>
  </view>

  <!-- 版本信息 -->
  <view class="version-section">
    <text class="version-text">版本 1.0.0</text>
    <text class="copyright-text">© 2024 大五人格测试</text>
  </view>

  <!-- 登录弹窗 -->
  <view wx:if="{{showLoginModal}}" class="login-modal">
    <view class="modal-mask" bindtap="hideLoginModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <view class="modal-logo">
          <text class="logo-text">🧠</text>
        </view>
        <view class="modal-close" bindtap="hideLoginModal">
          <text class="close-icon">×</text>
        </view>
      </view>
      
      <view class="modal-body">
        <view class="modal-title-section">
          <text class="modal-title">微信授权登录</text>
          <text class="modal-subtitle">获取您的头像和昵称，提供更好的服务体验</text>
        </view>
        
        <view class="permission-list">
          <view class="permission-item">
            <view class="permission-icon">👤</view>
            <view class="permission-info">
              <text class="permission-title">获取头像和昵称</text>
              <text class="permission-desc">用于展示您的个人信息</text>
            </view>
          </view>
          <view class="permission-item">
            <view class="permission-icon">📊</view>
            <view class="permission-info">
              <text class="permission-title">保存测试记录</text>
              <text class="permission-desc">记录您的测试历史和结果</text>
            </view>
          </view>
        </view>
        
        <view class="agreement-section">
          <view class="agreement-header">
            <view class="agreement-checkbox {{agreedToAgreement ? 'checked' : ''}}" bindtap="toggleAgreement">
              <text wx:if="{{agreedToAgreement}}" class="check-mark">✓</text>
            </view>
            <text class="agreement-title">阅读并同意以下协议</text>
          </view>
          <view class="agreement-links">
            <view class="link-item" bindtap="viewAgreementInModal">
              <text class="link-text">《用户协议》</text>
              <text class="link-arrow">›</text>
            </view>
            <view class="link-item" bindtap="viewPrivacyInModal">
              <text class="link-text">《隐私政策》</text>
              <text class="link-arrow">›</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="hideLoginModal">取消</button>
        <button class="modal-btn confirm-btn {{!agreedToAgreement ? 'disabled' : ''}}" 
                bindtap="confirmLogin" disabled="{{!agreedToAgreement}}">
          <view class="btn-icon">
            <text class="wechat-icon-small">💬</text>
          </view>
          <text class="btn-text">确认登录</text>
        </button>
      </view>
    </view>
  </view>
</view>