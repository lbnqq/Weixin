<!--pages/test-connection/test-connection.wxml-->
<view class="test-connection-container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">🔗 数据库连接测试</text>
    <text class="page-subtitle">测试Supabase数据库连接状态</text>
  </view>

  <!-- 连接状态 -->
  <view class="status-section">
    <view class="status-card">
      <text class="status-label">连接状态：</text>
      <text class="status-value {{connectionStatus}}">
        {{connectionStatusText}}
      </text>
    </view>
    <view class="status-card" wx:if="{{responseTime}}">
      <text class="status-label">响应时间：</text>
      <text class="status-value">{{responseTime}}ms</text>
    </view>
  </view>

  <!-- 测试按钮 -->
  <view class="test-section">
    <button 
      class="test-btn primary" 
      bindtap="startConnectionTest"
      disabled="{{isTesting}}"
      loading="{{isTesting}}">
      {{isTesting ? '测试中...' : '开始连接测试'}}
    </button>
    
    <button 
      class="test-btn secondary" 
      bindtap="startFullCrudTest"
      disabled="{{!isConnected || isTesting}}"
      loading="{{isTesting}}">
      {{isTesting ? '测试中...' : '完整CRUD测试'}}
    </button>
    
    <button 
      class="test-btn secondary" 
      bindtap="goToCrudTest"
      disabled="{{isTesting}}">
      高级CRUD测试
    </button>
  </view>

  <!-- 测试结果 -->
  <view class="results-section" wx:if="{{testResults.length > 0}}">
    <view class="section-header">
      <text class="section-title">📊 测试结果</text>
      <text class="result-count">{{testResults.length}} 项</text>
    </view>
    
    <scroll-view scroll-y class="results-scroll">
      <view class="result-list">
        <view class="result-item {{item.status}}" wx:for="{{testResults}}" wx:key="timestamp">
          <view class="result-header">
            <text class="result-step">{{item.step}}</text>
            <text class="result-status">{{item.statusText}}</text>
          </view>
          <text class="result-message">{{item.message}}</text>
          <text class="result-timestamp">{{item.timestamp}}</text>
          
          <view class="result-data" wx:if="{{item.data}}">
            <text class="data-content">{{item.data}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 统计信息 -->
  <view class="stats-section" wx:if="{{testComplete}}">
    <view class="stats-card">
      <text class="stats-title">📈 测试统计</text>
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-value">{{totalTests}}</text>
          <text class="stat-label">总测试</text>
        </view>
        <view class="stat-item success">
          <text class="stat-value">{{successTests}}</text>
          <text class="stat-label">成功</text>
        </view>
        <view class="stat-item error">
          <text class="stat-value">{{failedTests}}</text>
          <text class="stat-label">失败</text>
        </view>
        <view class="stat-item">
          <text class="stat-value">{{successRate}}</text>
          <text class="stat-label">成功率</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 返回按钮 -->
  <view class="footer-section">
    <button 
      class="test-btn secondary" 
      bindtap="goBack"
      disabled="{{isTesting}}">
      返回上一页
    </button>
  </view>
</view>