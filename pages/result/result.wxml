<!--pages/result/result.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading-section">
    <view class="loading-icon">ğŸ¤–</view>
    <text class="loading-text">AIæ­£åœ¨åˆ†æä½ çš„æ€§æ ¼ç‰¹å¾...</text>
    <text class="loading-subtitle">è¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ—¶é—´</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:if="{{error}}" class="error-section">
    <view class="error-icon">âŒ</view>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="calculateResult">é‡æ–°è®¡ç®—</button>
  </view>

  <!-- ç»“æœå±•ç¤º -->
  <view wx:if="{{!isLoading && !error}}" class="result-section">
    <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
    <view class="header-section">
      <view wx:if="{{userInfo}}" class="user-info">
        <image class="user-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill" />
        <view class="user-details">
          <text class="user-name">{{userInfo.nickName}}</text>
          <text class="result-title">æ€§æ ¼åˆ†ææŠ¥å‘Š</text>
        </view>
      </view>
      <view wx:else class="anonymous-info">
        <view class="anonymous-avatar">ğŸ‘¤</view>
        <text class="result-title">æ€§æ ¼åˆ†ææŠ¥å‘Š</text>
      </view>
    </view>

    <!-- å¾—åˆ†å±•ç¤º -->
    <view wx:if="{{scores}}" class="scores-section">
      <view class="section-title">äº”ç»´åº¦å¾—åˆ†</view>

      <view class="scores-grid">
        <view wx:for="{{['openness', 'conscientiousness', 'extraversion', 'agreeableness', 'neuroticism']}}"
              wx:key="*this" class="score-item">
          <view class="score-header">
            <text class="score-icon">
              <text wx:if="{{item === 'openness'}}">ğŸ¨</text>
              <text wx:if="{{item === 'conscientiousness'}}">ğŸ“‹</text>
              <text wx:if="{{item === 'extraversion'}}">ğŸŒŸ</text>
              <text wx:if="{{item === 'agreeableness'}}">ğŸ¤</text>
              <text wx:if="{{item === 'neuroticism'}}">ğŸ˜°</text>
            </text>
            <text class="score-name">
              <text wx:if="{{item === 'openness'}}">å¼€æ”¾æ€§</text>
              <text wx:if="{{item === 'conscientiousness'}}">å°½è´£æ€§</text>
              <text wx:if="{{item === 'extraversion'}}">å¤–å‘æ€§</text>
              <text wx:if="{{item === 'agreeableness'}}">å®œäººæ€§</text>
              <text wx:if="{{item === 'neuroticism'}}">ç¥ç»è´¨</text>
            </text>
          </view>
          <view class="score-value">{{scores[item].average}}</view>
          <view class="score-bar">
            <view class="score-fill" style="width: {{scores[item].average / 5 * 100}}%"></view>
          </view>
        </view>
      </view>
    </view>

    <!-- AIåˆ†æç»“æœ -->
    <view wx:if="{{aiSummary}}" class="summary-section">
      <view class="section-title">AIæ™ºèƒ½åˆ†æ</view>

      <!-- åˆ†ææ ‡ç­¾é¡µåˆ‡æ¢ -->
      <view class="analysis-tabs">
        <view class="tab-item {{activeTab === 'personality' ? 'active' : ''}}"
              bindtap="switchTab" data-tab="personality">
          <text class="tab-icon">ğŸ§ </text>
          <text class="tab-text">åŸºç¡€åˆ†æ</text>
        </view>
        <view class="tab-item {{activeTab === 'mbti' ? 'active' : ''}}"
              bindtap="switchTab" data-tab="mbti">
          <text class="tab-icon">ğŸ­</text>
          <text class="tab-text">MBTIç±»å‹</text>
        </view>
        <view class="tab-item {{activeTab === 'belbin' ? 'active' : ''}}"
              bindtap="switchTab" data-tab="belbin">
          <text class="tab-icon">ğŸ‘¥</text>
          <text class="tab-text">å›¢é˜Ÿè§’è‰²</text>
        </view>
        <view class="tab-item {{activeTab === 'career' ? 'active' : ''}}"
              bindtap="switchTab" data-tab="career">
          <text class="tab-icon">ğŸš€</text>
          <text class="tab-text">å‘å±•å»ºè®®</text>
        </view>
      </view>

      <!-- åŸºç¡€åˆ†æå†…å®¹ -->
      <view wx:if="{{activeTab === 'personality'}}" class="tab-content">
        <view class="content-item personality-item">
          <view class="content-header">
            <text class="content-icon personality-icon">ğŸ§ </text>
            <text class="content-title personality-title">æ€§æ ¼åˆ†æ</text>
          </view>
          <view class="content-text personality-text">
            <text>{{aiSummary.personality}}</text>
          </view>
        </view>

        <view class="content-item career-item">
          <view class="content-header">
            <text class="content-icon career-icon">ğŸ’¼</text>
            <text class="content-title career-title">èŒä¸šå»ºè®®</text>
          </view>
          <view class="content-text career-text">
            <text>{{aiSummary.career}}</text>
          </view>
        </view>

        <view class="content-item relationship-item">
          <view class="content-header">
            <text class="content-icon relationship-icon">ğŸ¤</text>
            <text class="content-title relationship-title">äººé™…å…³ç³»</text>
          </view>
          <view class="content-text relationship-text">
            <text>{{aiSummary.relationship}}</text>
          </view>
        </view>
      </view>

      <!-- MBTIåˆ†æå†…å®¹ -->
      <view wx:if="{{activeTab === 'mbti' && mbtiResult}}" class="tab-content">
        <!-- MBTIç±»å‹å±•ç¤º -->
        <view class="mbti-header">
          <view class="mbti-type-display">
            <text class="mbti-type-code">{{mbtiResult.type}}</text>
            <text class="mbti-type-name">{{mbtiResult.profile.name}}</text>
            <view class="mbti-confidence">
              <text class="confidence-text">ç½®ä¿¡åº¦: {{mbtiResult.confidence}}%</text>
              <view class="confidence-bar">
                <view class="confidence-fill" style="width: {{mbtiResult.confidence}}%"></view>
              </view>
            </view>
          </view>
          <view class="mbti-actions">
            <button class="copy-btn" bindtap="copyMBTIType">
              <text class="copy-icon">ğŸ“‹</text>
              <text>å¤åˆ¶</text>
            </button>
          </view>
        </view>

        <!-- MBTIç»´åº¦åˆ†æ -->
        <view class="mbti-dimensions">
          <view wx:for="{{mbtiResult.dimensions}}" wx:key="type" class="dimension-item">
            <view class="dimension-header">
              <text class="dimension-code">{{item.type}}</text>
              <text class="dimension-name">{{item.chineseName}} ({{item.fullType}})</text>
              <text class="dimension-score">{{item.score}}</text>
            </view>
            <view class="dimension-desc">
              <text>{{item.description}}</text>
            </view>
          </view>
        </view>

        <!-- MBTIè¯¦ç»†åˆ†æ -->
        <view class="content-item mbti-analysis-item">
          <view class="content-header">
            <text class="content-icon mbti-icon">ğŸ­</text>
            <text class="content-title mbti-title">MBTIæ€§æ ¼æ·±åº¦è§£æ</text>
          </view>
          <view class="content-text mbti-text">
            <text>{{aiSummary.mbtiAnalysis}}</text>
          </view>
        </view>

        <!-- MBTIç‰¹å¾æè¿° -->
        <view wx:if="{{mbtiResult.profile}}" class="mbti-traits">
          <view class="traits-header">
            <text class="traits-title">æ€§æ ¼ç‰¹å¾</text>
          </view>
          <view class="traits-grid">
            <view wx:for="{{mbtiResult.profile.traits}}" wx:key="*this" class="trait-chip">
              <text>{{item}}</text>
            </view>
          </view>
          <view class="mbti-careers">
            <text class="careers-title">é€‚åˆèŒä¸š</text>
            <view class="careers-list">
              <text wx:for="{{mbtiResult.profile.career}}" wx:key="*this" class="career-tag">{{item}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- è´å°”å®¾å›¢é˜Ÿè§’è‰²åˆ†æ -->
      <view wx:if="{{activeTab === 'belbin' && belbinResult}}" class="tab-content">
        <!-- ä¸»è¦è§’è‰²å±•ç¤º -->
        <view class="belbin-header">
          <view class="belbin-primary-role">
            <text class="role-title">ä¸»è¦å›¢é˜Ÿè§’è‰²</text>
            <view class="role-display">
              <text class="role-name">{{belbinResult.primaryRole.name}}</text>
              <view class="role-fit-score">
                <text>é€‚é…åº¦: {{belbinResult.primaryRole.fitScore}}%</text>
                <view class="fit-bar">
                  <view class="fit-fill" style="width: {{belbinResult.primaryRole.fitScore}}%"></view>
                </view>
              </view>
            </view>
            <view class="role-actions">
              <button class="copy-btn" bindtap="copyBelbinRole">
                <text class="copy-icon">ğŸ“‹</text>
                <text>å¤åˆ¶</text>
              </button>
            </view>
          </view>
        </view>

        <!-- è§’è‰²è¯¦ç»†æè¿° -->
        <view class="content-item belbin-analysis-item">
          <view class="content-header">
            <text class="content-icon belbin-icon">ğŸ‘¥</text>
            <text class="content-title belbin-title">è´å°”å®¾å›¢é˜Ÿè§’è‰²åˆ†æ</text>
          </view>
          <view class="content-text belbin-text">
            <text>{{aiSummary.belbinAnalysis}}</text>
          </view>
        </view>

        <!-- è§’è‰²ç‰¹å¾ -->
        <view wx:if="{{belbinResult.primaryRole}}" class="role-details">
          <view class="role-section">
            <text class="role-section-title">å…³é”®ç‰¹å¾</text>
            <view class="role-traits">
              <view wx:for="{{belbinResult.primaryRole.keyTraits}}" wx:key="*this" class="role-trait-item">
                <text class="trait-bullet">â€¢</text>
                <text class="trait-text">{{item}}</text>
              </view>
            </view>
          </view>

          <view class="role-section">
            <text class="role-section-title">å›¢é˜Ÿè´¡çŒ®</text>
            <view class="role-contributions">
              <view wx:for="{{belbinResult.primaryRole.contributions}}" wx:key="*this" class="role-contribution-item">
                <text class="contribution-icon">âœ“</text>
                <text class="contribution-text">{{item}}</text>
              </view>
            </view>
          </view>

          <view class="role-section">
            <text class="role-section-title">å‘å±•å»ºè®®</text>
            <view class="role-development">
              <view wx:for="{{belbinResult.primaryRole.development}}" wx:key="*this" class="role-development-item">
                <text class="development-icon">ğŸ¯</text>
                <text class="development-text">{{item}}</text>
              </view>
            </view>
          </view>
        </view>

        <!-- è¾…åŠ©è§’è‰² -->
        <view wx:if="{{belbinResult.secondaryRoles.length > 0}}" class="secondary-roles">
          <text class="secondary-title">è¾…åŠ©è§’è‰²</text>
          <view class="secondary-roles-list">
            <view wx:for="{{belbinResult.secondaryRoles}}" wx:key="name" class="secondary-role-item">
              <text class="secondary-role-name">{{item.name}}</text>
              <text class="secondary-role-fit">é€‚é…åº¦: {{item.fitScore}}%</text>
            </view>
          </view>
        </view>
      </view>

      <!-- èŒä¸šå‘å±•å»ºè®® -->
      <view wx:if="{{activeTab === 'career'}}" class="tab-content">
        <view class="content-item career-development-item">
          <view class="content-header">
            <text class="content-icon career-dev-icon">ğŸš€</text>
            <text class="content-title career-dev-title">èŒä¸šå‘å±•å»ºè®®</text>
          </view>
          <view class="content-text career-dev-text">
            <text>{{aiSummary.careerDevelopment}}</text>
          </view>
        </view>

        <view class="content-item personal-growth-item">
          <view class="content-header">
            <text class="content-icon growth-icon">ğŸŒ±</text>
            <text class="content-title growth-title">ä¸ªäººæˆé•¿ç­–ç•¥</text>
          </view>
          <view class="content-text growth-text">
            <text>{{aiSummary.personalGrowth}}</text>
          </view>
        </view>

        <!-- ç»¼åˆå»ºè®® -->
        <view class="comprehensive-advice">
          <text class="advice-title">ğŸ’¡ ç»¼åˆå»ºè®®</text>
          <view class="advice-content">
            <text class="advice-text">
              ç»“åˆä½ çš„MBTIç±»å‹{{mbtiResult.type}}å’Œè´å°”å®¾è§’è‰²{{belbinResult.primaryRole.name}}ï¼Œ
              å»ºè®®ä½ åœ¨èŒä¸šé€‰æ‹©å’Œä¸ªäººå‘å±•ä¸­å……åˆ†å‘æŒ¥è‡ªå·±çš„ç‹¬ç‰¹ä¼˜åŠ¿ã€‚
            </text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions-section">
      <button class="action-btn primary" bindtap="shareResult">
        <text class="btn-icon">ğŸ“·</text>
        <text class="btn-text">ä¿å­˜åˆ°ç›¸å†Œ</text>
      </button>

      <button class="action-btn secondary" bindtap="retakeTest">
        <text class="btn-icon">ğŸ”„</text>
        <text class="btn-text">é‡æ–°æµ‹è¯•</text>
      </button>

      <button class="action-btn secondary" bindtap="viewHistory">
        <text class="btn-icon">ğŸ“‹</text>
        <text class="btn-text">æŸ¥çœ‹å†å²</text>
      </button>
    </view>

    <!-- åº•éƒ¨æç¤º -->
    <view class="footer-section">
      <text class="footer-text">æµ‹è¯•ç»“æœä»…ä¾›å‚è€ƒï¼Œæ¯ä¸ªäººçš„æ€§æ ¼éƒ½æ˜¯ç‹¬ç‰¹çš„</text>
    </view>
  </view>

  <!-- åˆ†äº«å›¾ç‰‡ç”»å¸ƒï¼ˆéšè—ï¼‰ -->
  <canvas canvas-id="shareCanvas" style="position: fixed; top: -9999px; left: -9999px; width: 750px; height: 1200px;"></canvas>
</view>